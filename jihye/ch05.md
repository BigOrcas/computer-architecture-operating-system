# **Chapter 05 CPU 성능 향상 기법**

## 05-1 빠른 CPU를 위한 설계 기법

### 클럭

- 일반적으로 클럭 속도가 높은 CPU는 성능이 좋다.
- 헤르츠 단위로 측정
    - 1초에 클럭이 몇 번 반복되는지
- 클럭 속도를 높인다고해서 무조건 CPU가 빨라지는 건 아니다.
    - 클럭 속도를 높이면 발열 문제도 존재함

### 코어와 멀티 코어

- 클럭 속도를 높이는 방법 외에 CPU 성능을 높이는 방법
    - CPU의 코어 수를 늘린다.
        - 코어를 여러 개 포함하고 있는 CPU를 멀티코어 또는 멀티코어 프로레서 라고 부른다.
            - CPU 내에 명령어를 처리하는 일꾼이 여러 명 있는 것과 같다.
        - CPU의 연산 속도가 코어 수에 비례하여 증가하지는 않는다. 중요한 건 **코어마다 처리할 명령어들을 얼마나 적절하게 분배하느냐**이고 그에 따라서 연산속도는 크게 달라진다.
    - 스레드 수를 늘린다.

### 스레드와 멀티스레드

- 스레드
    - 사전적 의미: 실행 흐름의 단위
    - 하드웨어적 의미: 하나의 코어가 동시에 처리하는 명령어 단위
    - 소프트웨어적 의미: 하나의 프로그램에서 독립적으로 실행되는 단위
- 종류
    - 하드웨어적 스레드
        - 하나의 코어로 여러 명령어를 동시에 처리하는 CPU를 **멀티스레드 프로세서** 또는 **멀티스레드 CPU** 라고 한다.
            - 어떻게 가능할까?
                - 하나의 명령어를 처리하기 위해 꼭 필요한 레지스터를 여러 개 가지고 있으면 된다.
    - 소프트웨어적 스레드

### 코어와 멀티스레드의 차이

- 코어
    - 명령어를 실행할 수 있는 ‘하드웨어 부품’
- 스레드
    - 명령어를 실행하는 단위
- 참고
    - 멀티코어 프로세서
        - 명령어를 실행할 수 있는 하드웨어 부품이 CPU 안에 두 개 이상 있는 CPU
    - 멀티스레드 프로세서
        - 하나의 코어로 여러 개의 명령어를 동시에 실행할 수 있는 CPU

## 05-2 명령어 병렬 처리 기법 1

- 명령어 병렬 처리 기법: 명령어를 동시에 처리하여 CPU를 쉬지 않고 작동시키는 기법
    - 명령어 파이프라이닝
    - 슈퍼스칼라
    - 비순차적 명령어 처리

### 명령어 파이프라인

- 동시에 여러 개의 명령어를 겹처 실행하는 기법
    - 마치 공장 생산 라인과 같이 명령어들을 명령어 파이프라인에 넣고 동시에 처리하는 기법
- 파이프라인 위험
    - 파이브라이닝이 높은 성능을 가져오지만, 특정 상황에서는 성능 향상에 실패하는 경우도 있다. 이런 상황을 파이프라인 위험이라고 한다.
    - 종류
        - 데이터 위험
            - 명령어 간 ‘데이터 의존성’에 의해 발생
        - 제어 위험
            - 주로 분기 등으로 인한 ‘프로그램 카운터의 갑작스러운 변화’ 에 의해 발생
                - 이를 위해 사용하는 기술 중 하나가 ‘분기 예측’이다.
        - 구조적 위험(== 자원위험)
            - 명령어들을 겹쳐 실행하는 과정에서 서로 다른 명령어가 동시에 ALU, 레지스터 등과 같은 CPU 부품을 사용하려고 할 때 발생한다.

> 참고: **명령어 처리 과정**을 클럭 단위로 나누어 보면
> 1. 명령어 인출
> 2. 명령어 해석
> 3. 명령어 실행
> 4. 결과 저장

### 슈퍼스칼라

- CPU 내부에 여러 개의 명령어 파이프라인을 포함한 구조를 슈퍼스칼라 라고 한다.
- 슈퍼 스칼라 구조로 명령어 처리가 가능한 CPU를 슈퍼스칼라 프로세서 또는 슈퍼스칼라 CPU라고 한다.
- 이론적으로 파이프라인 개수에 비례하여 프로그램 처리 속도가 빨라진다.
    - 하지만 파이프라인 위험 등의 예상치 못한 문제가 있어 실제로는 반드시 비례하진 않는다.

### 비순차적 명령어 처리

- 명령어들을 순차적으로 실행하지 않는 기법
    - 명령어의 합법적인 새치기
- 파이프라인의 중단을 방지하기 위해 명령어를 순차적으로 처리하지 않는 명령어 병럴 처리 기법

## 05-3 CISC와 RISC

- 명령어 파이프라인과 슈퍼스칼라 기법을 실제로 CPU에 적용하려면 명령어가 파이프라이닝에 최적화되어 있어야 한다.
    - 쉽게 말하면 CPU가 파이프라이닝과 슈퍼스칼리 기법을 효과적으로 사용하려면 CPU가 인출하고 해석하고 실행하는 **명령어가 파이프라이닝 하기 쉽게 생겨야 한다.**

### 명령어 집합

- CPU가 이해할 수 있는 명령어들의 모음

### ISA(Instruction Set Architecture)

- 명령어 집합 구조
- CPU의 언어이자 하드웨어가 소프트웨어를 어떻게 이해할지에 대한 약속
- CPU마다 ISA가 다를 수 있다.
- 현대 ISA의 양대산맥
    - CISC
    - RISC

### CISC(Complex Instruction Set Computer)

- 복잡하고 다양한 명령어 집합을 활용하는 CPU 설계 방식
    - 복잡하고 다양한 종류의 **가변 길이** 명령어 집합을 활용
- 장점
    - 복잡하고 다양한 기능을 제공해서 적은 수의 명령으로 프로그램을 동작시키고 메모리를 절약할 수 있다.
- 단점
    - 명령어의 규격화가 어려워 파이프라이닝이 어렵다.
- CISC의 한계를 통해 알 수 있는 것
    - 빠른 처리를 위해 명령어 파이프라인을 활용해야 한다.
        - 명령어 길이와 수행 시간이 짧고 규격화되어 있어야 한다.
    - 자주 쓰이는 기본적인 명령어를 작고 빠르게 만드는 것이 중요하다.

### RISC(Reduced Instruction Set Computer)

- CISC에 비해 명령어의 종류가 적고, 짧다.
- 규격화된 명령어, 되도록 1클럭 내외로 실행되는 명령어를 지향한다.
    - 명령어 파이프라이닝에 최적화
- 단순하고 적은 종류의 **고정 길이** 명령어 집합을 활용한다.
- load-store 구조
- 메모리 접근을 단순화, 최소화하는 대신 레지스터를 적극 활용한다.

---

### 내 생각
- 스레드 의미가 정확하게 와닿지 않았었는데 사전적, 하드웨어적, 소프트웨어적 의미를 나눠서 생각하니 좀 더 이해하기 쉽다고 느꼈다. 
### 논의 내용
- 웹개발자로서 CPU 성능 향상 기법은 어떻게 활용될 수 있을까요? 